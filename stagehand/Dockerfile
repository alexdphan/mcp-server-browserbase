# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
# Use a Node.js image to build the MCP server
FROM node:22.12-alpine AS builder

# Set the working directory
WORKDIR /app

# Copy the package.json and package-lock.json for installing dependencies
COPY stagehand/package.json stagehand/package-lock.json ./

# Install the necessary dependencies
RUN --mount=type=cache,target=/root/.npm npm install

# Copy the source code into the container
COPY stagehand/src ./src
COPY stagehand/tsconfig.json ./

# Build the project
RUN npm run build

# Use a lighter Node.js image for the release
FROM node:22-alpine AS release

# Set the working directory
WORKDIR /app

# Copy the built files from the builder stage
COPY --from=builder /app/dist ./dist

# Copy the package.json for running the application
COPY --from=builder /app/package.json ./

# Set environment variables required for the MCP server
ENV BROWSERBASE_API_KEY=<YOUR_BROWSERBASE_API_KEY>
ENV BROWSERBASE_PROJECT_ID=<YOUR_BROWSERBASE_PROJECT_ID>
ENV OPENAI_API_KEY=<YOUR_OPENAI_API_KEY>

# Set the entry point for the application
ENTRYPOINT ["node", "dist/index.js"]